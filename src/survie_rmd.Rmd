---
title: "Description SLA VNI"
author: "Sarah F FELDMAN"
date: "14 décembre 2016"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
#1/ Bases utilisees pour la selection des patients:

Toutes


#3/ Description de la base filtree:

```{r, echo=FALSE, message=FALSE}
library(knitr)
library(dplyr)
library(stringr)
library(survival)
library(lubridate)

#sla <- readRDS("data/BDDSLADEM.rds")
#sla <- readRDS("F:/to push/sla_git/data/BDDSLADEM.rds")
sla <- readRDS("F:/to push/sla_git/data/BASE_SLA.rds")
sla$ddn <- ifelse (!is.na(sla$date_dc) & sla$ddn > sla$date_dc, sla$date_dc, sla$ddn)
sla$ddn <- as_date (sla$ddn)

sla$time.vni <- as.numeric(sla$ddn - sla$DATEVNI)
sla$time.sym <- as.numeric(sla$ddn - sla$FIRSTSYMPTOM)
sla$censor <- ifelse (!is.na(sla$date_dc),1, 0)
#sla$SEX <- factor(sla$SEX, levels=c(1,2), labels=c("h","f") ) #1 = 'Masculin' 2 = 'Feminin'
sla$age_diag <- round((sla$date_diag-sla$DOB)/365.25,0)
sla <- sla[sla$time.vni>=0, ] #3 patients décédés avant vni

dim(sla)
```

Sélection de tous les patients avec un diagnostic de SLA et une date de début de VNI.


##Nombre de donnees manquantes pour la date des dernieres nouvelles: aucune
```{r}
table(is.na(sla$ddn))
```


#4/ Analyses de survie univariee

##a- Version : date de debut de suivi = date des premiers symptomes



###range date de debut

```{r}
range(sla$FIRSTSYMPTOM,na.rm=TRUE)
table(is.na(sla$FIRSTSYMPTOM))
```

###courbe de Kaplan Meier

```{r, echo=FALSE}
idc.surv <- survfit(Surv(sla$time.sym,sla$censor)~1, conf.int=.95)
plot(idc.surv, xlab = "time (days)")
```

###Mediane de suivi 

```{r, echo=FALSE}
idc.suiv <- survfit(Surv(sla$time.sym,1-sla$censor)~1)
#min(idc.suiv$time[idc.suiv$surv<=0.5])
j <- paste0 (summary(idc.suiv)$table['median']," [",summary(idc.suiv)$table['0.95LCL'],"-",summary(idc.suiv)$table['0.95UCL'],"]")
an <- paste0 (round(summary(idc.suiv)$table['median']/365.25,2)," [",round(summary(idc.suiv)$table['0.95LCL']/365.25,2),"-",round(summary(idc.suiv)$table['0.95UCL']/365.25,2),"]")
```
En jour : `r j`
En annee : `r an`


###Mediane de survie 

```{r, echo=FALSE}
#min(idc.surv$time[idc.surv$surv<=0.5])
j <- paste0 (summary(idc.surv)$table['median']," [",summary(idc.surv)$table['0.95LCL'],"-",summary(idc.surv)$table['0.95UCL'],"]")
an <- paste0 (round(summary(idc.surv)$table['median']/365.25,2)," [",round(summary(idc.surv)$table['0.95LCL']/365.25,2),"-",round(summary(idc.surv)$table['0.95UCL']/365.25,2),"]")
```
En jour : `r j`  
En annee : `r an`


```{r,echo=FALSE, eval=FALSE}

#monthly estimates print:
summary(idc.surv, seq(30,max(idc.surv$time),by=30))

```



##b- Version : date de debut de suivi = date de debut de VNI

###range date de debut

```{r, echo=FALSE}
range(sla$DATEVNI)
```

###courbe de Kaplan Meier

```{r, echo=FALSE}
debvni <- survfit(Surv(sla$time.vni,sla$censor)~1, conf.int=.95)
plot(debvni, xlab = "time (days)")
```

###Mediane de suivi (en jour)

```{r, echo=FALSE}
debvni.suiv <- survfit(Surv(sla$time.vni,1-sla$censor)~1)
#min(debvni.suiv$time[debvni.suiv$surv<=0.5])
j <- paste0 (summary(debvni.suiv)$table['median']," [",summary(debvni.suiv)$table['0.95LCL'],"-",summary(debvni.suiv)$table['0.95UCL'],"]")
an <- paste0 (round(summary(debvni.suiv)$table['median']/365.25,2)," [",round(summary(debvni.suiv)$table['0.95LCL']/365.25,2),"-",round(summary(debvni.suiv)$table['0.95UCL']/365.25,2),"]")
```
En jour : `r j`  
En annee : `r an`

###Mediane de survie (en jour)

```{r, echo=FALSE}
#min(debvni$time[debvni$surv<=0.5]) #debvni
j <- paste0 (summary(debvni)$table['median']," [",summary(debvni)$table['0.95LCL'],"-",summary(debvni)$table['0.95UCL'],"]")
an <- paste0 (round(summary(debvni)$table['median']/365.25,2)," [",round(summary(debvni)$table['0.95LCL']/365.25,2),"-",round(summary(debvni)$table['0.95UCL']/365.25,2),"]")
```
En jour : `r j`
En annee : `r an`


